// Top-level build file where you can add configuration options common to all sub-projects/modules.

def androidProjectPath =  project.rootDir.absolutePath+"/android"
def iosProjectPath =  project.rootDir.absolutePath+"/ios"
def localizationPath =  project.rootDir.absolutePath+"/localization"
def androidModules = ['app']

buildscript {
    ext.kotlin_version = '1.3.50'
    repositories {
        google()
        jcenter()
        
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.5.1'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        google()
        jcenter()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}

// Generates strings from twine for the project
task generateProjectStrings {
    def totalScript = ""
    def source = localizationPath+"/localization.txt"
    //android
    androidModules.each { moduleName ->
        def destinationAndroid = androidProjectPath+"/"+moduleName+"/src/main/res"
        totalScript += "twine generate-all-localization-files " + source + " " + destinationAndroid +"--tags" + moduleName + " --validate --format android; "
    }
    //ios
    def destinationIos = iosProjectPath+"/Playground/Resources"
    totalScript += "twine generate-all-localization-files " + source + " " + destinationIos +" --validate --format apple; "

    def script = 'if hash twine 2>/dev/null; then '+ totalScript+ ' fi'

    doLast {
        print(script)
        exec {
            executable "sh"
            args '-c', script
        }
    }
}

task generateMetrics() {
    // TODO generate metrics for each module and save it to a file
}